<!DOCTYPE html>
<html layout:decorate="~{layout}">
<div layout:fragment="content">
  <link rel="stylesheet" type="text/css" th:href="@{/css/login.css}">
  <header th:replace="~{header :: headerFragment}"></header>
  <div class="user_form_wrapper" style="width: 400px">
    <h1><i class="fa-solid fa-user"></i>E-Mail変更</h1>
    <form id="login_form" method="post" th:action="@{/mypage/reemail}">
      <input
          type="hidden"
          th:name="${_csrf.parameterName}"
          th:value="${_csrf.token}"
      />
      <p>現在E-Mail :<span th:text="${user.email}"></span></p>
      <p>新しいE-Mailを入力してくだたい</p>

      <input type="email" class="form-control" id="newEmail" name="newEmail" placeholder="新しいE-Mail" />
      <button type="button" id="checkEmailBtn">중복확인</button>
      <div id="emailCheckResult" class="alert"></div>
      <div class="btn_area">
        <button type="submit" class="btn_submit">
          <span>E-Mailを変更する</span>
        </button>
      </div>
      <a th:href="@{/mypage}">マイページに戻る</a>
    </form>
  </div>
</div>
<script type="text/javascript" src="js/login.js"></script>
<script layout:fragment="script" type='text/javascript'>
$(document).ready(function() {
    $("#checkEmailBtn").click(function() {
        var newEmail = $("#newEmail").val();
        $.ajax({
            type: "GET",
            url: "/check-email",
            data: { newEmail: newEmail },
            success: function(result) {
                if (result) {
                    $("#emailCheckResult").text("사용 가능한 이메일입니다.");
                } else {
                    $("#emailCheckResult").text("이미 등록된 이메일입니다.");
                }
            },
            error: function() {
                alert("이메일 중복확인에 실패하였습니다.");
            }
        });
    });
});
</script>
</html>